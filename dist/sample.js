(()=>{"use strict";var t,e,s={};let i=0;class n{constructor(t,e,s,r={}){if("string"!=typeof t)throw new TypeError("Gestures require a string type / name");this.type=t,this.id=`gesture-${this.type}-${i++}`,this.element=e,this.handler=s,this.options={...n.DEFAULTS,...r}}isEnabled(t){const e=t.active.length,s=t.event,{enableKeys:i,disableKeys:n,minInputs:r,maxInputs:a}=this.options;return r<=e&&a>=e&&(0===i.length||i.some((t=>s[t])))&&!n.some((t=>s[t]))}start(){return null}move(){return null}end(){return null}cancel(){return null}evaluateHook(t,e){const s=this[t](e);s&&this.recognize(t,e,s)}recognize(t,e,s){this.handler({centroid:e.centroid,event:e.event,phase:t,type:this.type,target:this.element,...s})}}n.DEFAULTS={enableKeys:[],disableKeys:[],minInputs:1,maxInputs:Number.MAX_VALUE},e=n;var r={},a={},o={};class h{constructor(t=0,e=0){this.x=t,this.y=e}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}anglesTo(t){return t.map((t=>this.angleTo(t)))}averageDistanceTo(t){return this.totalDistanceTo(t)/t.length}clone(){return new h(this.x,this.y)}distanceTo(t){return Math.hypot(t.x-this.x,t.y-this.y)}minus(t){return new h(this.x-t.x,this.y-t.y)}plus(t){return new h(this.x+t.x,this.y+t.y)}totalDistanceTo(t){return t.reduce(((t,e)=>t+this.distanceTo(e)),0)}static centroid(t=[]){if(0===t.length)return null;const e=h.sum(t);return e.x/=t.length,e.y/=t.length,e}static sum(t=[]){return t.reduce(((t,e)=>(t.x+=e.x,t.y+=e.y,t)),new h(0,0))}}o=h;var c;const u="cancel",l="end",d="move",p="start";var v=(c={CANCEL_EVENTS:["blur","pointercancel","touchcancel","mouseleave"],KEYBOARD_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup"],POINTER_EVENTS:["pointerdown","pointermove","pointerup"],TOUCH_EVENTS:["touchend","touchmove","touchstart"],STATE_KEYS:["altKey","ctrlKey","metaKey","shiftKey"],STATE_KEY_STRINGS:["Alt","Control","Meta","Shift"],CANCEL:u,END:l,MOVE:d,START:p,PHASE:{blur:u,pointercancel:u,touchcancel:u,mouseup:l,pointerup:l,touchend:l,mousemove:d,pointermove:d,touchmove:d,mousedown:p,pointerdown:p,touchstart:p},PHASES:[p,d,l,u]}).PHASE;a=class{constructor(t,e){const{clientX:s,clientY:i}=function(t,e){return t.changedTouches?Array.from(t.changedTouches).find((t=>t.identifier===e)):t}(t,e);this.event=t,this.type=v[t.type],this.time=Date.now(),this.point=new o(s,i)}};var m;const g=2*Math.PI,y=-Math.PI;function E(t,e){const s=new Set;return t.forEach((t=>{e(t)&&s.add(t)})),s}var T=(m={angularDifference:function(t,e){let s=t-e;return s<y?s+=g:s>Math.PI&&(s-=g),s},getPropagationPath:function(t){if("function"==typeof t.composedPath)return t.composedPath();const e=[];for(let s=t.target;s!==document;s=s.parentNode)e.push(s);return e.push(document),e.push(window),e},setDifference:function(t,e){return E(t,(t=>!e.has(t)))},setFilter:E}).getPropagationPath;r=class{constructor(t,e){const s=new a(t,e);this.initialElements=new WeakSet(T(t)),this.initial=s,this.current=s,this.previous=s,this.identifier=e}get phase(){return this.current.type}get startTime(){return this.initial.time}get elapsedTime(){return this.current.time-this.initial.time}totalDistance(){return this.initial.point.distanceTo(this.current.point)}update(t){this.previous=this.current,this.current=new a(t,this.identifier)}};var w,f={},S=c.CANCEL,P=c.END,A=c.MOVE,D=c.PHASE,G=c.START;const b=Symbol.for("inputs"),x={TouchEvent:function(t){Array.from(t.changedTouches).forEach((e=>{this.updateInput(t,e.identifier)}))},PointerEvent:function(t){this.updateInput(t,t.pointerId)},MouseEvent:function(t){0===t.button&&this.updateInput(t,t.button)}};f=class{constructor(t){this.element=t,this[b]=new Map,this.inputs=[],this.active=[],this.activePoints=[],this.centroid={},this.event=null}clearEndedInputs(){this[b].forEach(((t,e)=>{"end"===t.phase&&this[b].delete(e)}))}getInputsInPhase(t){return this.inputs.filter((e=>e.phase===t))}getInputsNotInPhase(t){return this.inputs.filter((e=>e.phase!==t))}hasNoInputs(){return 0===this[b].size}updateInput(t,e){switch(D[t.type]){case G:this[b].set(e,new r(t,e));try{this.element.setPointerCapture(e)}catch(t){}break;case P:try{this.element.releasePointerCapture(e)}catch(t){}case S:case A:this[b].has(e)&&this[b].get(e).update(t);break;default:console.warn(`Unrecognized event type: ${t.type}`)}}updateAllInputs(t){x[t.constructor.name].call(this,t),this.updateFields(t)}updateFields(t){this.inputs=Array.from(this[b].values()),this.active=this.getInputsNotInPhase("end"),this.activePoints=this.active.map((t=>t.current.point)),this.centroid=o.centroid(this.activePoints),this.event=t}};var I=c.CANCEL_EVENTS,L=c.KEYBOARD_EVENTS,N=c.MOUSE_EVENTS,C=c.POINTER_EVENTS,R=c.TOUCH_EVENTS,_=c.STATE_KEY_STRINGS,U=c.PHASE,k=c.CANCEL,F=c.END,O=c.START,M=m.setDifference,K=m.setFilter;class V{constructor(t=window,e={}){e={...V.DEFAULTS,...e},this.gestures=new Set,this.activeGestures=new Set,this.potentialGestures=new Set,this.element=t,this.options=e,this.state=new f(this.element),this.activate()}activate(){let t=[];t=this.options.preferPointer&&window.PointerEvent?C:N.concat(R);const e=this.arbitrate.bind(this);t.forEach((t=>{this.element.addEventListener(t,e,{capture:this.options.capture,once:!1,passive:!1})}));const s=this.cancel.bind(this);I.forEach((t=>{window.addEventListener(t,s)}));const i=this.handleKeyboardEvent.bind(this);L.forEach((t=>{window.addEventListener(t,i)}))}cancel(t){this.options.preventDefault&&t.preventDefault(),this.state.inputs.forEach((e=>{e.update(t)})),this.activeGestures.forEach((t=>{t.evaluateHook(k,this.state)})),this.state=new f(this.element),this.resetActiveGestures()}handleKeyboardEvent(t){if(_.indexOf(t.key)>=0){this.state.event=t;const e=this.activeGestures;this.setActiveGestures(),M(e,this.activeGestures).forEach((t=>{t.evaluateHook(F,this.state)})),M(this.activeGestures,e).forEach((t=>{t.evaluateHook(O,this.state)}))}}resetActiveGestures(){this.potentialGestures=new Set,this.activeGestures=new Set}setActiveGestures(){this.activeGestures=K(this.potentialGestures,(t=>t.isEnabled(this.state)))}setPotentialGestures(){const t=this.state.inputs[0];this.potentialGestures=K(this.gestures,(e=>t.initialElements.has(e.element)))}updateActiveGestures(t,e){U[t.type]===O&&(e&&this.setPotentialGestures(),this.setActiveGestures())}pruneActiveGestures(t){U[t.type]===F&&(this.state.hasNoInputs()?this.resetActiveGestures():this.setActiveGestures())}arbitrate(t){const e=this.state.hasNoInputs();this.state.updateAllInputs(t),this.updateActiveGestures(t,e),this.activeGestures.size>0&&(this.options.preventDefault&&t.preventDefault(),this.activeGestures.forEach((e=>{e.evaluateHook(U[t.type],this.state)}))),this.state.clearEndedInputs(),this.pruneActiveGestures(t)}addGesture(t){t.element.style.touchAction=this.options.touchAction,this.gestures.add(t)}removeGesture(t){this.gestures.delete(t),this.potentialGestures.delete(t),this.activeGestures.delete(t)}getGesturesByElement(t){return K(this.gestures,(e=>e.element===t))}removeGesturesByElement(t){this.getGesturesByElement(t).forEach((t=>this.removeGesture(t)))}}V.DEFAULTS={capture:!1,preferPointer:!0,preventDefault:!0,touchAction:"none"},w=V;const z=Symbol("cascade"),H=Symbol("smooth");class Y{constructor(t={}){const e={...Y.DEFAULTS,...t};this.next=null,!function(t){if(t)try{return window.matchMedia("(pointer: coarse)").matches}catch(t){return!0}return!1}(e.applySmoothing)?this.next=t=>t:this.next=this[H].bind(this),this.identity=e.identity,this[z]=this.identity}restart(){this[z]=this.identity}[H](t){const e=this.average(this[z],t);return this[z]=e,e}average(t,e){return(t+e)/2}}Y.DEFAULTS={applySmoothing:!0,identity:0};var $,B=(t={Gesture:e,Input:r,Point2D:o,PointerData:a,Region:w,Smoothable:Y,State:f,...c,...m}).Gesture,j=t.Point2D,W=t.Smoothable;$=class extends B{constructor(t,e,s={}){super("pan",t,e,s),this.previous=null,this.outgoing=new W({...s,identity:new j}),this.outgoing.average=(t,e)=>j.centroid([t,e])}restart(t){this.previous=t.centroid,this.outgoing.restart()}start(t){this.restart(t)}move(t){const e=t.centroid.minus(this.previous);return this.previous=t.centroid,{translation:this.outgoing.next(e)}}end(t){this.restart(t)}cancel(t){this.restart(t)}};var X,q=t.Gesture,Q=t.Smoothable;class J extends q{constructor(t,e,s={}){super("pinch",t,e,s={...J.DEFAULTS,...s}),this.previous=0,this.outgoing=new Q({...s,identity:1})}restart(t){this.previous=t.centroid.averageDistanceTo(t.activePoints),this.outgoing.restart()}start(t){this.restart(t)}move(t){const e=t.centroid.averageDistanceTo(t.activePoints),s=e/this.previous;return this.previous=e,{distance:e,scale:this.outgoing.next(s)}}end(t){this.restart(t)}cancel(t){this.restart(t)}}J.DEFAULTS=Object.freeze({minInputs:2}),X=J;var Z,tt=t.Gesture,et=t.Point2D,st=t.MOVE;class it extends tt{constructor(t,e,s={}){super("press",t,e,{...it.DEFAULTS,...s})}start(t){const e=t.centroid,s=Array.from(t.active);setTimeout((()=>{const i=t.active.filter((t=>s.includes(t)));if(i.length===s.length){const s=et.centroid(i.map((t=>t.current.point))),n=e.distanceTo(s);n<=this.options.tolerance&&this.recognize(st,t,{centroid:s,distance:n,initial:e})}}),this.options.delay)}}it.DEFAULTS=Object.freeze({delay:1e3,tolerance:10}),Z=it;var nt,rt,at=t.Smoothable,ot=t.Gesture,ht=t.Point2D,ct=t.Smoothable;class ut extends ot{constructor(t="pivotable",e,s,i={}){super(t,e,s,{...ut.DEFAULTS,...i}),this.pivot=null,this.previous=0,this.outgoing=new ct(i)}static getClientCenter(t){const e=t.getBoundingClientRect();return new ht(e.left+e.width/2,e.top+e.height/2)}updatePrevious(){throw"Gestures which extend Pivotable must implement updatePrevious()"}restart(t){this.options.dynamicPivot?(this.pivot=t.centroid,this.previous=0):(this.pivot=ut.getClientCenter(this.element),this.updatePrevious(t)),this.outgoing.restart()}start(t){this.restart(t)}end(t){t.active.length>0?this.restart(t):this.outgoing.restart()}cancel(){this.outgoing.restart()}}ut.DEFAULTS=Object.freeze({deadzoneRadius:15,dynamicPivot:!1}),rt=ut;nt=class extends rt{constructor(t,e,s={}){super("pull",t,e,s),this.outgoing=new at({...s,identity:1})}updatePrevious(t){this.previous=this.pivot.distanceTo(t.centroid)}move(t){const e=this.pivot,s=e.distanceTo(t.centroid),i=s/this.previous,{deadzoneRadius:n}=this.options;let r=null;return s>n&&this.previous>n&&(r={distance:s,scale:this.outgoing.next(i),pivot:e}),this.previous=s,r}};var lt,dt=t.angularDifference,pt=t.Gesture,vt=t.Smoothable;class mt extends pt{constructor(t,e,s={}){super("rotate",t,e,s={...mt.DEFAULTS,...s}),this.previousAngles=[],this.outgoing=new vt(s)}restart(t){this.previousAngles=t.centroid.anglesTo(t.activePoints),this.outgoing.restart()}start(t){this.restart(t)}move(t){const e=t.centroid.anglesTo(t.activePoints),s=e.reduce(((t,e,s)=>t+dt(e,this.previousAngles[s])),0);this.previousAngles=e;const i=s/t.activePoints.length;return{rotation:this.outgoing.next(i)}}end(t){this.restart(t)}cancel(){this.outgoing.restart()}}mt.DEFAULTS=Object.freeze({minInputs:2}),lt=mt;var gt,yt=t.Gesture;class Et extends yt{constructor(t,e,s={}){super("swipe",t,e,s),this.moves=[],this.saved=null}restart(){this.moves=[],this.saved=null}start(){this.restart()}move(t){this.moves.push({time:Date.now(),point:t.centroid}),this.moves.length>7&&this.moves.splice(0,this.moves.length-7)}end(t){const e=this.getResult();return this.moves=[],t.active.length>0?(this.saved=e,null):(this.saved=null,Et.validate(e))}cancel(){this.restart()}getResult(){if(this.moves.length<7)return this.saved;const{point:t,time:e}=this.moves[6];return{point:t,velocity:Et.calc_velocity(this.moves,6),direction:Et.calc_angle(this.moves,6),time:e,centroid:t}}static validate(t){return null==t||Date.now()-t.time>300?null:t}static calc_angle(t,e){const s=t[e].point;let i=0,n=0;for(let r=0;r<e;++r){const e=t[r].point.angleTo(s);i+=Math.sin(e),n+=Math.cos(e)}return i/=e,n/=e,Math.atan2(i,n)}static velocity(t,e){return e.point.distanceTo(t.point)/(e.time-t.time+1)}static calc_velocity(t,e){let s=0;for(let i=0;i<e;++i){const e=Et.velocity(t[i],t[i+1]);e>s&&(s=e)}return s}}gt=Et;var Tt,wt=t.angularDifference,ft=t.Smoothable;Tt=class extends rt{constructor(t,e,s={}){super("swivel",t,e,s),this.outgoing=new ft(s)}updatePrevious(t){this.previous=this.pivot.angleTo(t.centroid)}move(t){const e=this.pivot,s=e.angleTo(t.centroid),i=wt(s,this.previous);let n=null;return e.distanceTo(t.centroid)>this.options.deadzoneRadius&&(n={rotation:this.outgoing.next(i),pivot:e}),this.previous=s,n}};var St,Pt=t.Gesture,At=t.Point2D;class Dt extends Pt{constructor(t,e,s={}){super("tap",t,e,{...Dt.DEFAULTS,...s}),this.taps=[]}end(t){const e=Date.now(),{minDelay:s,maxDelay:i,maxRetain:n,numTaps:r,tolerance:a}=this.options;if(this.taps=this.taps.concat(t.getInputsInPhase("end")).filter((t=>{const r=t.elapsedTime,a=e-t.current.time;return r<=i&&r>=s&&a<=n})),this.taps.length!==r||this.taps.some((t=>t.totalDistance()>a)))return null;const o=At.centroid(this.taps.map((t=>t.current.point)));return this.taps=[],{centroid:o,...o}}}Dt.DEFAULTS=Object.freeze({minDelay:0,maxDelay:300,maxRetain:300,numTaps:1,tolerance:10}),St=Dt;var Gt=t.Gesture;class bt extends Gt{constructor(t,e,s={}){super("track",t,e,{...bt.DEFAULTS,...s})}data({activePoints:t}){return{active:t}}tracks(t){return this.options.phases.includes(t)}start(t){return this.tracks("start")?this.data(t):null}move(t){return this.tracks("move")?this.data(t):null}end(t){return this.tracks("end")?this.data(t):null}cancel(t){return this.tracks("cancel")?this.data(t):null}}bt.DEFAULTS=Object.freeze({phases:Object.freeze([])});const xt=new(s={Pan:$,Pinch:X,Press:Z,Pull:nt,Rotate:lt,Swipe:gt,Swivel:Tt,Tap:St,Track:bt,...t}).Region,It=document.querySelector("#container");function Lt(){return Math.floor(256*Math.random())}function Nt(t){return t*=.95,Math.abs(t)<.1?0:t}class Ct{constructor(t,e){this.element=document.createElement("div"),this.element.style.backgroundColor=e,this.label=document.createElement("h1"),this.label.innerText=t,this.element.appendChild(this.label),It.appendChild(this.element),this.rotation=0,this.scale=1,this.x=0,this.y=0,this.velocityX=0,this.velocityY=0,this.animate=!1,this.update_fn=this.update.bind(this),this.swipe_interval=null,this.swipe_fn=this.swipeAnimation.bind(this),this.setupTracking()}setupTracking(){const t={end:t=>{0==t.active.length&&(this.animate=!1)},start:()=>{this.animate=!0,window.requestAnimationFrame(this.update_fn),clearInterval(this.swipe_interval)}};xt.addGesture(new s.Track(this.element,(e=>t[e.phase](e)),{phases:Object.keys(t)}))}randomBackground(){const t=Lt(),e=Lt(),s=Lt();this.element.style.backgroundColor=`rgb(${t}, ${e}, ${s})`}addTap(t){return xt.addGesture(new s.Tap(this.element,(()=>{this.randomBackground()}),t)),this}addPress(t){return xt.addGesture(new s.Press(this.element,(()=>{this.randomBackground()}),t)),this}addRotate(t){return xt.addGesture(new s.Rotate(this.element,(t=>{this.rotation+=t.rotation}),t)),this}addPan(t){return xt.addGesture(new s.Pan(this.element,(t=>{this.x+=t.translation.x,this.y+=t.translation.y}),t)),this}addSwipe(t){return xt.addGesture(new s.Swipe(this.element,(t=>{const e=t.velocity>7?7:t.velocity;this.velocityX=e*Math.cos(t.direction)*7,this.velocityY=e*Math.sin(t.direction)*7,this.swipe_interval=setInterval(this.swipe_fn,16.666666666666668)}),t)),this}addSwivel(t){return xt.addGesture(new s.Swivel(this.element,(t=>{this.rotation+=t.rotation}),{pivotCenter:this.element,...t})),this}addPinch(t){return xt.addGesture(new s.Pinch(this.element,(t=>{this.scale*=t.scale}),t)),this}addPull(t){return xt.addGesture(new s.Pull(this.element,(t=>{this.scale*=t.scale}),{pivotCenter:this.element,...t})),this}update(){const t=`rotate(${this.rotation}rad) `,e=`translate(${this.x}px, ${this.y}px) `,s=`scale(${this.scale}) `;this.element.style.transform=e+t+s,this.animate&&window.requestAnimationFrame(this.update_fn)}swipeAnimation(){this.x+=this.velocityX,this.y+=this.velocityY,this.velocityX=Nt(this.velocityX),this.velocityY=Nt(this.velocityY),0===this.velocityY&&0===this.velocityX&&clearInterval(this.swipe_interval),window.requestAnimationFrame(this.update_fn)}}const Rt=Math.floor(360/13),_t=[];for(let t=0;t<13;t++){const e=Rt*t;_t.push(`hsl(${e}, 100%, 75%)`)}let Ut=0;function kt(){return _t[Ut++]}new Ct("TAP",kt()).addTap(),new Ct("PAN",kt()).addPan(),new Ct("PINCH",kt()).addPinch(),new Ct("ROTATE",kt()).addRotate(),new Ct("SWIPE",kt()).addSwipe(),new Ct("PRESS",kt()).addPress(),new Ct("SWIVEL",kt()).addSwivel(),new Ct("PULL",kt()).addPull(),new Ct("TAP, PAN, PINCH, SWIPE, and ROTATE\n(desktop: CTRL to SWIVEL and PULL)",kt()).addTap().addPan({disableKeys:["ctrlKey"]}).addPinch().addRotate().addSwipe().addSwivel({enableKeys:["ctrlKey"]}).addPull({enableKeys:["ctrlKey"]}),new Ct("QUICK DOUBLE TAP",kt()).addTap({numTaps:2}),new Ct("FIVE QUICK TAPS",kt()).addTap({maxDelay:1e3,maxRetain:1e3,numTaps:5}),new Ct("SLOW TAP",kt()).addTap({minDelay:300,maxDelay:1e3}),new Ct("TWO SLOW TAPS",kt()).addTap({minDelay:300,maxDelay:1e3,maxRetain:2e3,numTaps:2})})();
//# sourceMappingURL=sample.js.map
